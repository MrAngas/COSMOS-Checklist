<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 
        Secret Code Explanation:
        - All subtasks and comment boxes are styled identically for visual distinction.
        - The reset button unchecks all tasks without refreshing the page.
        - The dark mode button toggles the dark theme for the page.
        - The design is responsive for different screen sizes.
        - Clicking "suggestion" opens the mail app with recipient and subject pre-filled.
        - Change Log button toggles the visibility of the change log.
        - Hyperlinks turn green in dark mode.
        - Red Explanation mark appiers when there is recent features added to Change Log.
        - Clicking No hides not necessary sub-tasks.
        - COSMOS checklist made by Paulina PISTAC@danskebank.lt
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSMOS Checklist</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #F6F8FB;
            --bg-card: #fff;
            --border: #E6EBF1;
            --subtask-bg: #f9fafc;
            --subtask-outline: #e0e6ef;
            --text-main: #102130;
            --primary: #0070C9;
            --primary-dark: #005FAD;
            --primary-light: #E6F1FB;
            --green-bg: #D8F5E6;
            --green-txt: #1B7A54;
            --blue-bg: #E6F1FB;
            --blue-txt: #0070C9;
            --orange: #C66A0A;
            --radius: 12px;
            --font-main: 'Inter', Arial, sans-serif;
            --shadow: 0 2px 8px 0 rgba(16,33,48,0.04);
        }
        html, body {
            background: var(--bg-main);
            color: var(--text-main);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            background: var(--bg-card);
            width: 100%;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 24px 0 16px 0;
            margin-bottom: 32px;
            z-index: 2;
        }
        .header img {
            position: absolute;
            left: 32px;
            width: 120px;
        }
        .header-content {
            font-family: var(--font-main);
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-main);
            flex: 1;
            text-align: center;
            letter-spacing: -0.01em;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .header-buttons {
            display: flex;
            gap: 12px;
            position: absolute;
            right: 32px;
            top: 24px;
        }
        .header button {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 32px;
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 15px;
            padding: 8px 22px;
            cursor: pointer;
            box-shadow: none;
            outline: none;
            transition: background 0.18s;
            letter-spacing: 0.01em;
        }
        .header button:hover {
            background: var(--primary-dark);
        }
        .dark-mode .header button, .header button.dark-mode {
            background: #1a2533;
            color: #fff;
            border: none;
        }
        .exclamation-mark {
            margin-left: 4px;
            background: #C33A2F;
            color: #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            top: -2px;
        }
        .task-list {
            width: 95%;
            max-width: 840px;
            margin: 0 auto;
            margin-top: 0;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            padding: 28px 30px 20px 30px;
            list-style: none;
            text-align: left;
            z-index: 1;
        }
        .task-list li {
            background: transparent;
            border-bottom: 1px solid var(--border);
            padding: 16px 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            font-size: 1.09rem;
            font-weight: 500;
        }
        .task-list li:last-child {
            border-bottom: none;
        }
        .task-list label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            font-weight: 500;
            gap: 8px;
        }
        .task-list a {
            color: var(--primary);
            text-decoration: underline dotted;
            font-weight: 600;
        }
        .task-list input[type="checkbox"], .task-list input[type="radio"] {
            accent-color: var(--primary);
            width: 20px;
            height: 20px;
            margin-left: 14px;
        }
        /* Sub-task wrapper: visually distinct, outlined, padded, rounded */
        .sub-tasks {
            list-style: none;
            margin: 8px 0 0 0;
            padding: 0;
            border: none;
        }
        .sub-tasks li {
            font-size: 1rem;
            font-weight: 400;
            color: var(--text-main);
            background: var(--subtask-bg);
            border: 1.5px solid var(--subtask-outline);
            border-radius: 10px;
            margin: 0 0 10px 0;
            padding: 16px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
            transition: background 0.2s, border 0.2s;
        }
        .sub-tasks li:last-child {
            margin-bottom: 0;
        }
        .dark-mode .sub-tasks li {
            background: #232c3a;
            border-color: #343c49;
            color: #e0e4e9;
        }
        /* Comment boxes: same style everywhere, fully aligned, matching subtask look */
        .comment-box {
            width: 100%;
            background: var(--subtask-bg);
            border: 1.5px solid var(--subtask-outline);
            border-radius: 10px;
            padding: 16px 18px;
            margin: 12px 0 12px 0;
            font-size: 1rem;
            color: var(--text-main);
            white-space: pre-wrap;
            box-sizing: border-box;
            display: block;
        }
        .dark-mode .comment-box {
            background: #232c3a;
            border-color: #343c49;
            color: #e0e4e9;
        }
        #highRiskKINDIComment {
            word-break: break-word;
        }
        #highRiskKINDIComment a {
            white-space: nowrap;
        }
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .reset-button {
            margin: 36px 0 10px 0;
            padding: 14px 40px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 32px;
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.18s;
            box-shadow: var(--shadow);
        }
        .reset-button:hover {
            background: var(--primary-dark);
        }
        .footer {
            margin-top: auto;
            padding: 24px 8px 16px 8px;
            background: transparent;
            font-size: 15px;
            color: #7B8898;
            width: 100%;
            text-align: center;
        }
        .dropdown {
            display: none;
            position: absolute;
            top: 85px;
            right: 38px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 340px;
            text-align: left;
            z-index: 1000;
        }
        .dropdown ul {
            list-style: none;
            margin: 0;
            padding: 10px;
        }
        .dropdown ul li {
            padding: 10px 4px;
            border-bottom: 1px solid var(--border);
        }
        .dropdown ul li:last-child {
            border-bottom: none;
        }
        .dropdown ul li span {
            font-weight: 600;
            margin-right: 10px;
        }
        .dropdown button {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 18px;
            font-family: var(--font-main);
            font-weight: 500;
            font-size: 14px;
            padding: 5px 18px;
            cursor: pointer;
            margin: 0 2px;
            transition: background 0.18s;
        }
        .dropdown button:hover {
            background: var(--primary-dark);
        }
        .dropdown .changelog-indicator {
            color: #7B8898;
            font-size: 13px;
        }
        .radio-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
        }
        .radio-buttons label {
            display: flex;
            align-items: center;
            font-weight: 400;
            margin-right: 8px;
        }
        .radio-buttons input[type="radio"] {
            margin: 0 3px 0 0;
        }
        .dark-mode {
            background: #19212a !important;
            color: #e0e4e9 !important;
        }
        .dark-mode .header, .dark-mode .task-list, .dark-mode .dropdown, .dark-mode .footer {
            background: #232c3a !important;
            color: #e0e4e9 !important;
        }
        .dark-mode .header-content {
            color: #fff !important;
        }
        .dark-mode .task-list a {
            color: #4fbe4f !important;
        }
        .hidden { display: none; }

        .tasks-left-indicator {
            color: #C33A2F;
            font-weight: 700;
            font-size: 1.18rem;
            text-align: center;
            margin-bottom: 5px;
            min-height: 24px;
        }
        /* Well Done popup and confetti */
        .well-done-popup {
            position: fixed;
            z-index: 9999;
            left: 50%;
            top: 30%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #1B7A54;
            border-radius: 18px;
            box-shadow: 0 8px 48px 0 rgba(16,33,48,0.14);
            padding: 36px 50px 36px 50px;
            text-align: center;
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: 0.05em;
            border: 3px solid #1B7A54;
            display: none;
            animation: popup-bounce 1.2s cubic-bezier(.32,1.93,.37,1) 1;
        }
        @keyframes popup-bounce {
            0% { transform: translate(-50%, -70%) scale(0.7); opacity: 0; }
            60% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            80% { transform: translate(-50%, -48%) scale(0.99); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9998;
        }
        .confetti-piece {
            position: absolute;
            width: 12px;
            height: 18px;
            border-radius: 2px;
            opacity: 0.85;
            will-change: transform, opacity;
            animation: confetti-fall 2.2s linear forwards;
        }
        @keyframes confetti-fall {
            0% { opacity: 1; }
            100% { 
                transform: translateY(90vh) rotateZ(360deg) scale(1.2);
                opacity: 0.6;
            }
        }
        @media (max-width: 1150px) {
            .header {
                flex-direction: column;
                align-items: stretch;
                min-height: unset;
                padding-top: 28px;
                padding-bottom: 12px;
                position: static;
            }
            .header img {
                position: static;
                margin-bottom: 10px;
                align-self: flex-start;
            }
            .header-content {
                order: 2;
                margin-bottom: 10px;
                white-space: normal;
                font-size: 1.3rem;
            }
            .header-buttons {
                position: static;
                order: 3;
                margin-top: 8px;
                justify-content: center;
                flex-wrap: wrap;
                top: unset;
                right: unset;
                width: 100%;
            }
        }
        @media (max-width: 600px) {
            .task-list { padding: 14px 2vw 10px 2vw; }
            .header-content { font-size: 1.1rem; }
            .header img { width: 80px; }
            .header-buttons button { font-size: 13px; padding: 7px 12px; }
            .header { padding: 10px 0; }
            .dropdown { width: 97vw; right: 0vw; }
            .tasks-left-indicator { font-size: 1rem; }
            .well-done-popup { font-size: 1.3rem; padding: 30px 10vw; }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="unnamed.png" alt="Danske Bank Logo">
        <div class="header-content">COSMOS Checklist</div>
        <div class="header-buttons">
            <button class="download-calculator" onclick="window.location.href='https://github.com/MrAngas/COSMOS-Checklist/raw/main/Procentage%20calculator.xlsx'">Procentage Calculator</button>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">Dark Mode</button>
            <button class="change-log-toggle" onclick="toggleChangeLog()">Change Log <span class="exclamation-mark" id="exclamation-mark">!</span></button>
        </div>
    </div>
    <!-- Change Log Dropdown Carousel -->
    <div class="dropdown" id="change-log">
        <div id="change-log-entry"></div>
        <div style="text-align:center;margin:10px 0;">
            <button id="prev-changelog" type="button" style="margin-right:8px;">Previous</button>
            <button id="next-changelog" type="button">Next</button>
        </div>
        <div class="changelog-indicator" style="text-align:center;">
            <span id="changelog-indicator"></span>
        </div>
    </div>
    <ul class="task-list" id="task-list">
        <li>
            <label>
                <span>Check if minor/elder has Managed accounts <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/Ef410zciF7xBhF51qo5PYeIBDaddtYZ8PkBEoz-8OyYTuA?e=X8BRzK" target="_blank">(3946)</a>.</span>
                <input type="checkbox" class="task" onchange="updateProgress()">
            </label>
        </li>
        <li>
            <label>
                <span>Check customer`s/KINDI Lifecycle status <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EZjzBcC5_HpNncXmnUNTL2gBEh0R7tzIg75JL4JaJKsSug?e=raOeAK" target="_blank">(CLM)</a>.</span>
                <input type="checkbox" class="task" onchange="updateProgress()">
            </label>
        </li>
        <li>
            <label style="display: flex; align-items: center;">
                <span>Do you have KINDI, which has a higher risk rating compared to the customer?</span>
                <div class="radio-buttons">
                    <label><input type="radio" name="highRiskKINDI" value="yes" onclick="updateHighRiskKINDI()"> Yes</label>
                    <label><input type="radio" name="highRiskKINDI" value="no" onclick="updateHighRiskKINDI()"> No</label>
                </div>
            </label>
            <div class="comment-box hidden" id="highRiskKINDIComment">
                Check KINDI risk rating against customer's own risk rating, if the KINDI risk rating is higher, follow Domas <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EZkqfKFeo6hMtIBbvcFZ1vUBZfb0f3g5Uk7rE91nogGipQ?e=eOwApb" target="_blank">letter.</a>
            </div>
        </li>
        <li>
            <label style="display: flex; align-items: center;">
                <span>Do you have ‚ÄúTransactional‚Äù drop-off, which requires Trust? (Example: Unclassified)</span>
                <div class="radio-buttons">
                    <label><input type="radio" name="transactionalDropOff" value="yes" onclick="updateTransactionalDropOff()"> Yes</label>
                    <label><input type="radio" name="transactionalDropOff" value="no" onclick="updateTransactionalDropOff()"> No</label>
                </div>
            </label>
            <ul class="sub-tasks hidden" id="transactionalDropOffTasks">
                <li>
                    <label>
                        <span>Write SOF assessment in the case conclusion. If deductions are needed, create the ‚Äûsource of funds‚Äú drop-off.</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
                <li>
                    <label>
                        <span>If deductions were made, make sure to add SOF ‚ÄúOther‚Äù sentence (in the table below).</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
            </ul>
        </li>
        <li>
            <label style="display: flex; align-items: center;">
                <span>Do you have cash drop-off?</span>
                <div class="radio-buttons">
                    <label><input type="radio" name="cashDropOff" value="yes" onclick="updateCashDropOff()"> Yes</label>
                    <label><input type="radio" name="cashDropOff" value="no" onclick="updateCashDropOff()"> No</label>
                </div>
            </label>
            <ul class="sub-tasks hidden" id="cashDropOffTasks">
                <li>
                    <label>
                        <span>Check deviation of cash transfers (<a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EUXhOOVp9bxOoyjUaeDicmcB_A30UnGEUWRhC4BW--NdmQ?e=R09ud2" target="_blank">use thresholds table</a>). If cash transfers have deviation -/+ 25% and more ‚Äì ensure the major deviation sentence is used for all cash transfers.</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
                <li>
                    <label>
                        <span>If deductions were made, make sure to update expected behavior (in the table below).</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
            </ul>
        </li>
        <li>
            <label style="display: flex; align-items: center;">
                <span>Do you have foreign drop-off?</span>
                <div class="radio-buttons">
                    <label><input type="radio" name="foreignDropOff" value="yes" onclick="updateForeignDropOff()"> Yes</label>
                    <label><input type="radio" name="foreignDropOff" value="no" onclick="updateForeignDropOff()"> No</label>
                </div>
            </label>
            <ul class="sub-tasks hidden" id="foreignDropOffTasks">
                <li>
                    <label>
                        <span>Check deviation of foreign transfers (<a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EUXhOOVp9bxOoyjUaeDicmcB_A30UnGEUWRhC4BW--NdmQ?e=R09ud2" target="_blank">use thresholds table</a>). If foreign transfers have deviation -/+ 25% and more ‚Äì ensure the major deviation sentence is used for all foreign transfers</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
                <li>
                    <label>
                        <span>If deductions were made, make sure to update expected behavior (in the table below).</span>
                        <input type="checkbox" class="task" onchange="updateProgress()">
                    </label>
                </li>
            </ul>
        </li>
        <li>
            <label style="display: flex; align-items: center;">
                <span>Is calculated <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EVUrhj2JSpNOkaL_Gc11bk0BRr5KJNuRYDCsWxpt8admdA?e=wJEBDo" target="_blank">AUM</a> above 5MDKK.</span>
                <div class="radio-buttons">
                    <label><input type="radio" name="aum" value="yes" onclick="updateAUM()"> Yes</label>
                    <label><input type="radio" name="aum" value="no" onclick="updateAUM()"> No</label>
                </div>
            </label>
            <div class="aum-tasks hidden">
                <ul class="sub-tasks">
                    <li>
                        <label>
                            <span>Leave newly calculated AUM as it is</span>
                            <input type="checkbox" class="task" onchange="updateProgress()">
                        </label>
                    </li>
                    <li>
                        <label>
                            <span>Check customer`s pensions (PensionInfo doc., Wealth Planner, Portal)</span>
                            <input type="checkbox" class="task" onchange="updateProgress()">
                        </label>
                    </li>
                    <li>
                        <label>
                            <span>Check customer`s real estate (Portal, Wealth Planner, BiQ, Annual tax assessment, capital statement)</span>
                            <input type="checkbox" class="task" onchange="updateProgress()">
                        </label>
                    </li>
                    <li>
                        <label>
                            <span>Check customer`s owned companies (Portal, BiQ, Wealth Planner)</span>
                            <input type="checkbox" class="task" onchange="updateProgress()">
                        </label>
                    </li>
                    <li>
                        <label>
                            <span>If customer`s AUM is above 75 MDKK, perform AMS.</span>
                            <input type="checkbox" class="task" onchange="updateProgress()">
                        </label>
                    </li>
                </ul>
            </div>
            <div class="aum-comment hidden comment-box">
                Leave newly calculated AUM as it is;
                Delete all old registrations from Source of Wealth table in Portal.
            </div>
        </li>
        <li>
            <label>
                <span>Check <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EYTol5Z34i1Fgdo-nlMolGQB4deNhHG1WTv2mBPZBVdXyw?e=XDlIgI" target="_blank">deposit securities</a> (the review period is provided in TRUST for each customer). Comment on case conclusion, if there was any.</span>
                <input type="checkbox" class="task" onchange="updateProgress()">
            </label>
        </li>
        <li>
            <label>
                <span>Check customer`s <a href="https://danskebankgroup.sharepoint.com/:b:/t/FAQMA/EVdvn_RUdL9EhgQKxbtaBMQBJrS1i8fl3dch_vGjJKouJg?e=75iy4h" target="_blank">mandate holders</a> (later ‚Äì MH). If MH is in PWM, do CDD for them. Comment on case conclusion, if relation is not clear.</span>
                <input type="checkbox" class="task" onchange="updateProgress()">
            </label>
        </li>
    </ul>
    <div class="tasks-left-indicator" id="tasks-left-indicator"></div>
    <button class="reset-button" onclick="resetTasks()">Reset</button>
    <div class="footer">
        If you encounter any errors or have a <a href="mailto:PSTAC@danskebank.lt?subject=COSMOS%20Checklist%20suggestions">suggestion</a>, reach me via Teams PSTAC<br>
        Checklist updated on 2025.05.29<br>
    </div>
    <!-- Well Done popup and confetti container -->
    <div class="well-done-popup" id="well-done-popup">üéâ Well Done! üéâ</div>
    <div class="confetti" id="confetti"></div>
    <script>
        // --- CHANGE LOG CAROUSEL CODE ---
        const changeLogEntries = [
            { date: "2025-02-27", text: "Initial release of the COSMOS checklist." },
            { date: "2025-02-28", text: "Updates: Clicking \"suggestion\" opens mail app with recipient and subject, Added Change Log button, Fixed wording in \"Transactional\" drop-off step." },
            { date: "2025-03-03", text: "Updates: Notes added on \"Check KINDI in Portal\" task." },
            { date: "2025-03-04", text: "Updates: Added Hyperlinks that link to steps, that are related to 3946, AUM, Deposited securityes, Mandate holders \"How-tos\", also Change Log gets dark-mode." },
            { date: "2025-03-17", text: "Updates: Added KINDI risk rating against customers own risk rating line with hiperlink. Also added exclamation mark on Change Log button, when Checklist is updated a red explanation mark appiers." },
            { date: "2025-03-18", text: "Updates: Added Yes and No options for tasks that have mulltiple sub-tasks, added new sub-tasks for Is calculated AUM above 5MDKK. task." },
            { date: "2025-03-19", text: "Updates: updated NBV KINDI task and its sub comment-box to High risk KINDI, added additional information and hiperlinks to foreigh and cash tasks, also changed AUM hiperlink." },
            { date: "2025-03-25", text: "Updates: Changed wording on KINDI task." },
            { date: "2025-05-09", text: "Updates: Deleted 1 task, changed wording on ‚ÄúTransactional‚Äù drop-off text, also added new button for downloading Procentage calculator excel file." },
            { date: "2025-05-16", text: "Updates: Change Log changed from list to carousel, also whole page updated to look more like Cosmos apps." },
            { date: "2025-05-23", text: "Updates: Added new CLM task with active hyperlink to CLM decision tree." },
            { date: "2025-05-29", text: "Updates: Added new count for unchecked tasks, that helps minimize errors, also added fun stuff." }
        ];
        let currentChangeLogIndex = changeLogEntries.length - 1;
        function showChangeLogEntry(index) {
            const entry = changeLogEntries[index];
            const entryDiv = document.getElementById('change-log-entry');
            entryDiv.innerHTML = `<ul><li><span>${entry.date}:</span> ${entry.text}</li></ul>`;
            document.getElementById('changelog-indicator').textContent =
                `Change ${index + 1} of ${changeLogEntries.length}`;
        }
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('prev-changelog').onclick = function() {
                currentChangeLogIndex =
                    (currentChangeLogIndex - 1 + changeLogEntries.length) % changeLogEntries.length;
                showChangeLogEntry(currentChangeLogIndex);
            };
            document.getElementById('next-changelog').onclick = function() {
                currentChangeLogIndex =
                    (currentChangeLogIndex + 1) % changeLogEntries.length;
                showChangeLogEntry(currentChangeLogIndex);
            };
            // Exclamation mark logic
            const exclamationMark = document.getElementById('exclamation-mark');
            const lastUpdateDate = changeLogEntries[changeLogEntries.length - 1].date;
            if (localStorage.getItem('changeLogViewedDate') === lastUpdateDate) {
                exclamationMark.style.display = 'none';
            } else {
                exclamationMark.style.display = 'flex';
            }
            // Ensure KINDI comment is hidden or shown based on default radio state
            updateHighRiskKINDI();
        });
        function toggleChangeLog() {
            const changeLog = document.getElementById('change-log');
            const exclamationMark = document.getElementById('exclamation-mark');
            const lastUpdateDate = changeLogEntries[changeLogEntries.length - 1].date;
            if (changeLog.style.display === 'block') {
                changeLog.style.display = 'none';
            } else {
                changeLog.style.display = 'block';
                exclamationMark.style.display = 'none';
                localStorage.setItem('changeLogViewedDate', lastUpdateDate);
                currentChangeLogIndex = changeLogEntries.length - 1;
                showChangeLogEntry(currentChangeLogIndex);
            }
        }
        // --- END CHANGE LOG CODE ---
        // High Risk KINDI comment show/hide
        function updateHighRiskKINDI() {
            const yes = document.querySelector('input[name="highRiskKINDI"][value="yes"]');
            const comment = document.getElementById('highRiskKINDIComment');
            comment.classList.toggle('hidden', !(yes && yes.checked));
            updateTasksLeftIndicator();
        }
        function updateTransactionalDropOff() {
            const yes = document.querySelector('input[name="transactionalDropOff"][value="yes"]');
            document.getElementById('transactionalDropOffTasks').classList.toggle('hidden', !yes.checked);
            updateTasksLeftIndicator();
        }
        function updateCashDropOff() {
            const yes = document.querySelector('input[name="cashDropOff"][value="yes"]');
            document.getElementById('cashDropOffTasks').classList.toggle('hidden', !yes.checked);
            updateTasksLeftIndicator();
        }
        function updateForeignDropOff() {
            const yes = document.querySelector('input[name="foreignDropOff"][value="yes"]');
            document.getElementById('foreignDropOffTasks').classList.toggle('hidden', !yes.checked);
            updateTasksLeftIndicator();
        }
        function updateAUM() {
            const yes = document.querySelector('input[name="aum"][value="yes"]');
            const no = document.querySelector('input[name="aum"][value="no"]');
            const aumTasks = document.querySelector('.aum-tasks');
            const aumComment = document.querySelector('.aum-comment');
            aumTasks.classList.toggle('hidden', !yes.checked);
            aumComment.classList.toggle('hidden', !no.checked);
            updateTasksLeftIndicator();
        }
        function resetTasks() {
            document.querySelectorAll('.task').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = false;
                checkbox.classList.remove('disabled');
            });
            document.querySelectorAll('.aum-tasks, .aum-comment, #foreignDropOffTasks, #transactionalDropOffTasks, #cashDropOffTasks, #highRiskKINDIComment')
                .forEach(section => section.classList.add('hidden'));
            document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);

            // Ensure KINDI comment is hidden after reset
            updateHighRiskKINDI();
            // Also update the tasks left indicator after reset
            updateTasksLeftIndicator();
        }
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.querySelectorAll('.header, .task-list, .task-list li, .comment-box, .sub-tasks li, .footer, .dark-mode-toggle, .dropdown')
                .forEach(el => el.classList.toggle('dark-mode'));
        }
        window.addEventListener('DOMContentLoaded', function() {
            updateAUM();
            updateTasksLeftIndicator();
        });
        // Dummy updateProgress to avoid errors
        function updateProgress(){
            updateTasksLeftIndicator();
        }

        // --- TASKS LEFT INDICATOR CODE ---
        let lastTasksUnchecked = null;
        function updateTasksLeftIndicator() {
            // List of all main tasks (li elements directly under #task-list)
            const mainTasks = Array.from(document.querySelectorAll('#task-list > li'));
            let totalTasks = 0;
            let uncheckedTasks = 0;

            function countVisibleSubTasks(parentUlId) {
                const ul = document.getElementById(parentUlId);
                if (!ul || ul.classList.contains('hidden')) return {total: 0, unchecked: 0};
                const checkboxes = ul.querySelectorAll('input[type="checkbox"].task');
                let subtasks = {total: checkboxes.length, unchecked: 0};
                subtasks.unchecked = Array.from(checkboxes).filter(cb => !cb.checked).length;
                return subtasks;
            }
            function countAUMSubTasks() {
                const aumTasksDiv = document.querySelector('.aum-tasks');
                if (!aumTasksDiv || aumTasksDiv.classList.contains('hidden')) return {total: 0, unchecked: 0};
                const checkboxes = aumTasksDiv.querySelectorAll('input[type="checkbox"].task');
                return {total: checkboxes.length, unchecked: Array.from(checkboxes).filter(cb => !cb.checked).length};
            }
            // [0]: Managed accounts
            totalTasks++;
            if (!mainTasks[0].querySelector('input[type="checkbox"].task').checked) uncheckedTasks++;
            // [1]: Lifecycle status
            totalTasks++;
            if (!mainTasks[1].querySelector('input[type="checkbox"].task').checked) uncheckedTasks++;
            // [7]: Deposit securities
            totalTasks++;
            if (!mainTasks[7].querySelector('input[type="checkbox"].task').checked) uncheckedTasks++;
            // [8]: Mandate holders
            totalTasks++;
            if (!mainTasks[8].querySelector('input[type="checkbox"].task').checked) uncheckedTasks++;

            // Transactional drop-off subtasks
            let transactional = countVisibleSubTasks('transactionalDropOffTasks');
            totalTasks += transactional.total;
            uncheckedTasks += transactional.unchecked;
            // Cash drop-off subtasks
            let cash = countVisibleSubTasks('cashDropOffTasks');
            totalTasks += cash.total;
            uncheckedTasks += cash.unchecked;
            // Foreign drop-off subtasks
            let foreign = countVisibleSubTasks('foreignDropOffTasks');
            totalTasks += foreign.total;
            uncheckedTasks += foreign.unchecked;
            // AUM subtasks
            let aum = countAUMSubTasks();
            totalTasks += aum.total;
            uncheckedTasks += aum.unchecked;

            // High Risk KINDI radio
            const highRiskRadios = document.getElementsByName('highRiskKINDI');
            let highRiskChecked = Array.from(highRiskRadios).some(r => r.checked);
            totalTasks++;
            if (!highRiskChecked) uncheckedTasks++;
            // Transactional drop-off (radio)
            const transactionalRadios = document.getElementsByName('transactionalDropOff');
            let transactionalRadioChecked = Array.from(transactionalRadios).some(r => r.checked);
            if (transactional.total === 0) {
                totalTasks++;
                if (!transactionalRadioChecked) uncheckedTasks++;
            }
            // Cash drop-off (radio)
            const cashRadios = document.getElementsByName('cashDropOff');
            let cashRadioChecked = Array.from(cashRadios).some(r => r.checked);
            if (cash.total === 0) {
                totalTasks++;
                if (!cashRadioChecked) uncheckedTasks++;
            }
            // Foreign drop-off (radio)
            const foreignRadios = document.getElementsByName('foreignDropOff');
            let foreignRadioChecked = Array.from(foreignRadios).some(r => r.checked);
            if (foreign.total === 0) {
                totalTasks++;
                if (!foreignRadioChecked) uncheckedTasks++;
            }
            // AUM (radio)
            const aumRadios = document.getElementsByName('aum');
            let aumRadioChecked = Array.from(aumRadios).some(r => r.checked);
            if (aum.total === 0) {
                totalTasks++;
                if (!aumRadioChecked) uncheckedTasks++;
            }
            // Update the indicator
            let indicator = document.getElementById('tasks-left-indicator');
            if (uncheckedTasks === 1) {
                indicator.textContent = 'There is 1 unchecked task.';
            } else if (uncheckedTasks === 0) {
                indicator.textContent = 'All tasks completed!';
            } else {
                indicator.textContent = `There are ${uncheckedTasks} unchecked tasks.`;
            }
            // Show the Well Done popup and confetti when all tasks are done
            if (uncheckedTasks === 0 && lastTasksUnchecked !== 0) {
                showWellDonePopup();
            }
            lastTasksUnchecked = uncheckedTasks;
        }

        function showWellDonePopup() {
            const popup = document.getElementById('well-done-popup');
            popup.style.display = 'block';
            launchConfetti();
            setTimeout(() => {
                popup.style.display = 'none';
                clearConfetti();
            }, 2600); // About 2.5 seconds
        }

        function launchConfetti() {
            clearConfetti();
            const confettiColors = ["#1B7A54","#0070C9","#F2B400","#C33A2F","#4fbe4f","#C66A0A","#A259E6","#E76B74"];
            const confetti = document.getElementById('confetti');
            const pieces = 48;
            for (let i = 0; i < pieces; i++) {
                const div = document.createElement('div');
                div.className = 'confetti-piece';
                const color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                div.style.background = color;
                div.style.left = (Math.random() * 100) + 'vw';
                div.style.top = (Math.random() * 8) + 'vh';
                div.style.opacity = 0.8 + Math.random() * 0.2;
                div.style.transform = `rotate(${Math.random()*360}deg)`;
                div.style.animationDuration = (2 + Math.random() * 0.8) + 's';
                div.style.width = 10 + Math.random() * 10 + 'px';
                div.style.height = 16 + Math.random() * 10 + 'px';
                confetti.appendChild(div);
            }
        }
        function clearConfetti() {
            const confetti = document.getElementById('confetti');
            while (confetti.firstChild) confetti.removeChild(confetti.firstChild);
        }

        // ... (the rest of your existing event listener hooking code remains the same) ...
        document.querySelectorAll('input[type="radio"][name="highRiskKINDI"]').forEach(el => {
            el.addEventListener('change', updateHighRiskKINDI);
        });
        document.querySelectorAll('input[type="radio"][name="transactionalDropOff"]').forEach(el => {
            el.addEventListener('change', updateTransactionalDropOff);
        });
        document.querySelectorAll('input[type="radio"][name="cashDropOff"]').forEach(el => {
            el.addEventListener('change', updateCashDropOff);
        });
        document.querySelectorAll('input[type="radio"][name="foreignDropOff"]').forEach(el => {
            el.addEventListener('change', updateForeignDropOff);
        });
        document.querySelectorAll('input[type="radio"][name="aum"]').forEach(el => {
            el.addEventListener('change', updateAUM);
        });
        document.querySelectorAll('input[type="checkbox"].task').forEach(el => {
            el.addEventListener('change', updateTasksLeftIndicator);
        });

    </script>
</body>
</html>